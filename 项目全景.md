# MoP (Metrics-on-Process) 项目全景需求文档

## 1. 项目愿景 (Project Vision)
**MoP (Metrics-on-Process)** 旨在打造一个“设计即运行”的工业流程平台。它不仅是一个流程绘图工具，更是一个集成了指标实时监控（KPI Engine）、离散事件仿真（DES Simulation）以及操作标准管理（SOP Matrix）的数字化闭环系统。

---

## 2. 核心三级架构 (The 3-Level Hierarchy)

MoP 采用纵向钻取的架构，将复杂的工业流程拆解为三个逻辑层级：

| 层级 | 名称 | 核心关注点 | 表达形式 |
| :--- | :--- | :--- | :--- |
| **L1** | **全景图 (Macro View)** | 战略地图、部门间协同、端到端价值链 | 模块化区域 + 核心流程节点 |
| **L2** | **泳道图 (Micro View)** | 角色职责（Roles）、活动时效、逻辑分支 | BPMN 风格泳道图 + 资源绑定 |
| **L3** | **矩阵图 (Matrix View)** | 执行标准 (SOP)、质量/工艺标准、个体 PI | 角色-步骤协同矩阵 (RACI风格) |

---

## 3. 核心功能模块 (Key Modules)

### A. 智能建模引擎 (Modeling Engine)
- **可视化编辑**: 基于 ReactFlow 的拖拽式画布，支持 L1 节点钻取至 L2。
- **DSL 驱动**: 所有图表均由标准的 JSON DSL 驱动，支持跨系统导出与备份。

### B. KPI 响应引擎 (KPI Engine)
- **实时绑定**: 活动节点可绑定外部数据源（如 MES、ERP）。
- **红黄绿预警**: 系统根据“实绩 (Actual)”对比“目标 (Target)”，自动计算预警值并在画布上展示 🟢/🟡/🔴 状态标签。
- **全局数据表**: 提供一键呼出的项目全景数据表，支持指标的批量编辑。

### C. 离散事件仿真 (Simulation)
- **Token 动画**: 动态展示生产令牌（Tokens）在节点间的流动。
- **瓶颈分析**: 通过配置处理时间（Processing Time）和波动（Variance），模拟真实生产环境，识别资源分配瓶颈。

### D. 实时监控面板 (Real-time Monitor)
- **看板模式**: 将设计出的流程转化为实时运行监控画面。
- **动态渲染**: 实时的 Token 流转反映车间当前的真实任务进度。

---

## 4. 用户故事 (User Stories)

### 👤 流程架构师 (Process Architect)
> “我希望能够快速绘制复杂的生产流程，并为每个步骤定义精确的职能角色（Roles），以便明确管理边界。”

### 👤 生产经营经理 (Plant Manager)
> “我希望在控制室的大屏幕上直接看到流程图。如果某个环节的‘合格率’低于 80%，节点应该立刻变红提醒我，而不是让我去翻看报表。”

### 👤 培训与标准化专员 (SOP Specialist)
> “我需要导出 L3 级操作矩阵，作为新员工的培训教材，确保每个人都知道在自己的步骤里应该遵守什么工艺标准。”

---

## 5. 技术栈概览 (Technical Stack)
- **前端**: Next.js 14, React 18, Tailwind CSS v4
- **状态管理**: Zustand
- **流程引擎**: ReactFlow
- **后端/数据库**: Prisma + PostgreSQL/MySQL
- **文档规范**: 采用 DSL 驱动的 schema 验证 (Zod)
